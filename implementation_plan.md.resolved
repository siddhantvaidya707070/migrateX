# Demo Dashboard Implementation Plan

## ğŸ¯ Core Intent

Build a **demo-grade dashboard** that showcases the agent's intelligence through interactive simulations. A judge should understand the product in 30 seconds.

---

## 1. UI Structure

### Dashboard Layout

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  HEADER: "Self-Healing Support Agent" + Status Indicator        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                      â”‚  â”‚                                   â”‚ â”‚
â”‚  â”‚   HERO SECTION       â”‚  â”‚   AGENT PIPELINE STEPPER          â”‚ â”‚
â”‚  â”‚                      â”‚  â”‚                                   â”‚ â”‚
â”‚  â”‚   [Start Simulation] â”‚  â”‚   Observe â†’ Synthesize â†’          â”‚ â”‚
â”‚  â”‚   Primary CTA        â”‚  â”‚   Hypothesize â†’ Evaluate Risk â†’   â”‚ â”‚
â”‚  â”‚                      â”‚  â”‚   Decide â†’ Act â†’ Learn            â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚                                                               â”‚â”‚
â”‚  â”‚   LIVE ACTIVITY FEED (During Simulation)                      â”‚â”‚
â”‚  â”‚   - Events being ingested (with count & type)                 â”‚â”‚
â”‚  â”‚   - Decisions being made (classification + confidence)        â”‚â”‚
â”‚  â”‚   - Actions taken (with status badges)                        â”‚â”‚
â”‚  â”‚                                                               â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ Events        â”‚ â”‚ Risk Score    â”‚ â”‚ Actions                  â”‚â”‚
â”‚  â”‚ Ingested: 30  â”‚ â”‚ High: 2       â”‚ â”‚ Auto-Executed: 1         â”‚â”‚
â”‚  â”‚ Clustered: 1  â”‚ â”‚ Medium: 0     â”‚ â”‚ Pending Approval: 1      â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Component Structure

| Component | Location | Purpose |
|-----------|----------|---------|
| `AgentDashboard` | `src/components/views/agent-dashboard.tsx` | Main dashboard view |
| `SimulationModal` | `src/components/ui/simulation-modal.tsx` | Multi-step simulation setup |
| `PipelineVisualizer` | `src/components/ui/pipeline-visualizer.tsx` | 7-step agent pipeline display |
| `LiveActivityFeed` | `src/components/ui/live-activity-feed.tsx` | Real-time event stream |
| `MetricCards` | `src/components/ui/metric-cards.tsx` | Summary stats |
| `ApprovalQueue` | `src/components/ui/approval-queue.tsx` | Human-in-the-loop actions |

---

## 2. Simulation Flow

### Start Simulation Modal (4-Step Wizard)

**Step 1: Simulation Type**
| Option | Backend Endpoint | Risk Level |
|--------|------------------|------------|
| Checkout Failures | `/api/simulate/checkout_failure` | HIGH |
| Documentation Gaps | `/api/simulate/doc_gap` | LOW |
| Mixed Scenario | Both | MIXED |

**Step 2: Risk Profile**
- Low Risk (routine, obvious resolution)
- Medium Risk (ambiguous, needs reasoning)
- High Risk (urgent, costly, requires prioritization)

**Step 3: Volume/Intensity**
| Parameter | Options |
|-----------|---------|
| Event Count | 10, 30, 50 |
| Merchants Affected | 1, 3, 5 |
| Timing | Burst (instant) / Spaced (spread across time) |

**Step 4: Agent Behavior**
| Toggle | Default | Description |
|--------|---------|-------------|
| Auto-Act | ON | Agent executes low-risk actions automatically |
| Conservative Mode | OFF | Require approval for everything |
| Show Reasoning | ON | Display AI hypothesis details |

---

## 3. Backend Endpoints

### Existing Endpoints âœ…
| Endpoint | Method | Purpose |
|----------|--------|---------|
| `/api/agent-loop` | GET | Trigger full 7-step agent pipeline |
| `/api/ingest` | POST | Ingest raw events |
| `/api/simulate/checkout_failure` | POST | Generate checkout failure events |
| `/api/simulate/doc_gap` | POST | Generate documentation gap events |

### New Endpoints (Required)

#### 3.1 `GET /api/dashboard/stats`
Returns current dashboard statistics:
```json
{
  "events": { "total": 45, "unprocessed": 12 },
  "observations": { "active": 3, "resolved": 8 },
  "decisions": { "today": 5, "pending_approval": 2 },
  "risk_distribution": { "high": 2, "medium": 1, "low": 4 }
}
```

#### 3.2 `GET /api/dashboard/activity?limit=20`
Returns recent activity feed:
```json
{
  "activities": [
    { "type": "event_ingested", "data": {...}, "timestamp": "..." },
    { "type": "decision_made", "data": {...}, "timestamp": "..." },
    { "type": "action_executed", "data": {...}, "timestamp": "..." }
  ]
}
```

#### 3.3 `POST /api/dashboard/approve/:proposalId`
Human approval endpoint:
```json
{ "decision": "approve" | "reject", "notes": "..." }
```

#### 3.4 `POST /api/simulate/run`
Unified simulation trigger with parameters:
```json
{
  "scenario": "checkout_failure" | "doc_gap" | "mixed",
  "risk_profile": "low" | "medium" | "high",
  "event_count": 30,
  "merchant_count": 5,
  "timing": "burst" | "spaced",
  "auto_trigger_agent": true
}
```

---

## 4. Data Models

### Existing Database Tables âœ…
| Table | Purpose |
|-------|---------|
| `raw_events` | Ingested signals (with `fingerprint`, `merchant_id`, `source_origin`) |
| `observations` | Clustered patterns |
| `hypotheses` | AI-generated root causes |
| `risk_assessments` | Risk scores with factors |
| `decisions` | Classifications (4 types) |
| `action_proposals` | Pending/executed actions |
| `audit_logs` | Full reasoning trace with `run_id` |
| `human_approvals` | Approval decisions |

### Frontend State

```typescript
interface DashboardState {
  // Simulation
  isSimulating: boolean;
  currentRunId: string | null;
  simulationConfig: SimulationConfig | null;
  
  // Agent Pipeline
  currentStep: AgentStep | null; // 'observe' | 'synthesize' | 'hypothesize' | 'evaluate' | 'decide' | 'act' | 'learn'
  pipelineProgress: number; // 0-100
  
  // Live Data
  activities: Activity[];
  stats: DashboardStats;
  
  // Pending Actions
  pendingApprovals: ActionProposal[];
}
```

---

## 5. State Management

**Approach**: React Context + Server State (polling or SSE)

```typescript
// src/components/providers/dashboard-provider.tsx
export const DashboardProvider: React.FC<{children: React.ReactNode}>

// Provides:
// - simulationState
// - startSimulation(config)
// - triggerAgentLoop()
// - approveAction(id)
// - rejectAction(id)
// - refreshStats()
```

**Polling Strategy**:
- During simulation: Poll `/api/dashboard/activity` every 1s
- Idle: Poll every 5s
- Use `run_id` to filter relevant activity

---

## 6. Visual Design

### Color Palette
| Element | Color | Usage |
|---------|-------|-------|
| Primary | `#3B82F6` (blue-500) | CTAs, active states |
| Success | `#22C55E` (green-500) | Auto-executed, resolved |
| Warning | `#F59E0B` (amber-500) | Pending approval |
| Danger | `#EF4444` (red-500) | High risk |
| Muted | `#6B7280` (gray-500) | Secondary text |

### Pipeline Step Indicators
```
[â—] Observe    â†’ [â—] Synthesize â†’ [â—‹] Hypothesize â†’ ...
 â†‘ Complete      â†‘ In Progress    â†‘ Pending
```

### Animation Guidelines
- Smooth 200-300ms transitions
- Subtle pulse on active elements
- Staggered list animations (50ms delay per item)
- No jarring/flashy effects

---

## 7. Implementation Order

| Phase | Files | Effort |
|-------|-------|--------|
| **Phase 1: Core Structure** | | |
| 1.1 | `DashboardProvider` + context | 30 min |
| 1.2 | New API endpoints (stats, activity, simulate/run) | 45 min |
| 1.3 | `AgentDashboard` layout | 30 min |
| **Phase 2: Simulation Flow** | | |
| 2.1 | `SimulationModal` with wizard steps | 45 min |
| 2.2 | Wire to backend, handle responses | 30 min |
| **Phase 3: Live Visualization** | | |
| 3.1 | `PipelineVisualizer` component | 30 min |
| 3.2 | `LiveActivityFeed` with polling | 45 min |
| 3.3 | `MetricCards` with stats | 20 min |
| **Phase 4: Human-in-the-Loop** | | |
| 4.1 | `ApprovalQueue` component | 30 min |
| 4.2 | Approve/Reject API integration | 20 min |
| **Phase 5: Polish** | | |
| 5.1 | Animations & transitions | 30 min |
| 5.2 | Edge cases & loading states | 20 min |

**Estimated Total**: ~6 hours

---

## â“ Questions / Inputs Required

Before I proceed, I need confirmation on:

### 1. Supabase Connection
- âœ… **Confirmed**: Tables exist (`raw_events`, `observations`, `hypotheses`, `risk_assessments`, `decisions`, `action_proposals`, `audit_logs`, `human_approvals`)
- â“ Is the Supabase connection working via [.env.local](file:///c:/Users/Gaarth/Documents/prob2/.env.local)?
- â“ Is the Mistral API key configured for the Reasoner?

### 2. Existing Simulation Endpoints
- âœ… **Found**: `/api/simulate/checkout_failure` and `/api/simulate/doc_gap` in `app-backend/api/simulate/`
- â“ Have these been tested and confirmed working?

### 3. API Directory Structure
- ğŸ“ Currently: Backend APIs in `app-backend/api/`
- ğŸ“ Frontend: `src/app/`
- â“ Should new dashboard API routes go in `src/app/api/` or `app-backend/api/`?

### 4. Real vs Mock Integrations
| Integration | Status | Notes |
|-------------|--------|-------|
| Supabase DB | â“ Real | Needs verification |
| Mistral AI (Reasoner) | â“ Real | For hypothesis generation |
| Communication Tools | Mock | `sendSupportResponse`, `emailEngineering` log but don't send |
| Engineering Tools | Mock | `createEngineeringIncident` logs but doesn't create |

### 5. Assumptions
1. The current `app-backend/` structure is serving Next.js correctly (even though it's non-standard naming)
2. Tailwind CSS is configured and working
3. No authentication is required for the demo dashboard
4. Polling is acceptable (vs WebSockets/SSE)

---

## ğŸ›‘ STOP - Awaiting Your Approval

**I will NOT proceed with implementation until you explicitly approve this plan.**

Please review and confirm:
1. Is the UI structure acceptable?
2. Are the proposed endpoints correct?
3. Should I proceed with implementation?
4. Any changes to scope or priorities?
